<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="data:image/png;base64,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">
    <title>Multi-Mega Message Board</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 40px auto; background: #f4f4f9; }
        #board { background: white; border: 1px solid #ddd; height: 400px; overflow-y: auto; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .msg { padding: 10px; border-bottom: 1px solid #eee; }
        .user { font-weight: bold; color: #0070f3; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #0070f3; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>

    <script src="https://cdn.jsdelivr.net"></script>
</head>
<body>
    <h2>Multi-Mega Messenger</h2>
    <div id="board">Loading messages...</div>
    <input type="text" id="userInput" placeholder="Your Name">
    <input type="text" id="textInput" placeholder="Write a message...">
    <button onclick="sendMessage()">Post Message</button>

    <div id="auth-section">
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <input type="text" id="username" placeholder="Pick a Username">
      <button onclick="signUp()">Register</button>
      <button onclick="logIn()">Login</button>
    </div>

    <script>
        async function loadMessages() {
            const res = await fetch('/api/messages');
            const messages = await res.json();
            document.getElementById('board').innerHTML = messages.map(m => `
                <div class="msg"><span class="user">${m.user}:</span> ${m.text}</div>
            `).join('');
        }

        async function sendMessage() {
            const user = document.getElementById('userInput').value || "Guest";
            const text = document.getElementById('textInput').value;
            if(!text) return;

            await fetch('/api/messages', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user, text })
            });

            document.getElementById('textInput').value = '';
            loadMessages();
        }

        setInterval(loadMessages, 5000);
        loadMessages();

        async function signUp() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const username = document.getElementById('username').value;

  const { data, error } = await supabase.auth.signUp({ email, password });
  if (error) return alert(error.message);

  // Create the profile
  await supabase.from('profiles').insert([{ id: data.user.id, username }]);
  alert("Check your email for a confirmation link!");
}

async function logIn() {
  const { data, error } = await supabase.auth.signInWithPassword({
    email: document.getElementById('email').value,
    password: document.getElementById('password').value
  });
  if (error) return alert(error.message);
  localStorage.setItem('sb-token', data.session.access_token);
  location.reload(); // Refresh to show the post box
}
    </script>
</body>
</html>
